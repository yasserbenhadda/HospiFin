<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HospiFin Project: Comprehensive Technical Report</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
            background-color: #f9f9f9;
        }

        .container {
            background-color: white;
            padding: 3rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 0.5rem;
            margin-top: 0;
            font-size: 2.5rem;
        }

        h2 {
            color: #2c3e50;
            margin-top: 2.5rem;
            border-bottom: 1px solid #eee;
            padding-bottom: 0.5rem;
            font-size: 1.8rem;
        }

        h3 {
            color: #34495e;
            margin-top: 1.5rem;
            font-size: 1.3rem;
        }

        ul,
        ol {
            padding-left: 1.5rem;
        }

        li {
            margin-bottom: 0.5rem;
        }

        code {
            background-color: #f1f8ff;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
            font-size: 0.9em;
            color: #e83e8c;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        th,
        td {
            padding: 12px;
            border: 1px solid #e0e0e0;
            text-align: left;
        }

        th {
            background-color: #f8f9fa;
            font-weight: 600;
        }

        tr:nth-child(even) {
            background-color: #fcfcfc;
        }

        .note {
            background-color: #e7f5ff;
            border-left: 4px solid #3498db;
            padding: 1rem;
            margin: 1rem 0;
            font-style: italic;
        }

        .warning {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 1rem;
            margin: 1rem 0;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>HospiFin Project: Comprehensive Technical Report</h1>

        <h2>1. Executive Summary</h2>
        <p><strong>Project Name:</strong> HospiFin (Hospital Care Financial Anticipation Dashboard)<br>
            <strong>Type:</strong> Full-Stack Web & Mobile Application<br>
            <strong>Objective:</strong> Provide hospital administrators with real-time financial tracking, patient
            management, and AI-driven cost forecasting.
        </p>
        <p>The system uses a <strong>Spring Boot</strong> backend with an <strong>H2</strong> in-memory database for
            rapid development, a <strong>React/MUI</strong> frontend for the web dashboard, and a
            <strong>Flutter</strong> application for mobile access. Key differentiator is the <strong>Local LLM
                Integration</strong> (via LangChain4j) that uses RAG (Retrieval-Augmented Generation) to answer
            financial questions using real calculated data.</p>

        <h2>2. Technical Architecture & Stack</h2>

        <h3>2.1 Backend System (Server)</h3>
        <ul>
            <li><strong>Framework:</strong> Spring Boot 3.2.0</li>
            <li><strong>Language:</strong> Java 17</li>
            <li><strong>Build System:</strong> Maven</li>
            <li><strong>Database:</strong> H2 In-Memory (URL: <code>jdbc:h2:mem:hospital_db</code>)
                <div class="note">Configured in <code>src/main/resources/application.properties</code>. Data assumes
                    non-persistence (lost on restart) unless <code>DataSeeder</code> runs.</div>
            </li>
            <li><strong>AI Engine:</strong> LangChain4j interacting with local LM Studio.
                <ul>
                    <li>Model: <code>meta-llama-3.1-8b-instruct</code></li>
                    <li>URL: <code>http://127.0.0.1:1234/v1</code></li>
                </ul>
            </li>
        </ul>

        <h3>2.2 Frontend Client (Web)</h3>
        <ul>
            <li><strong>Framework:</strong> React 19</li>
            <li><strong>Bundler:</strong> Vite</li>
            <li><strong>UI System:</strong> Material UI (MUI) v7</li>
            <li><strong>Routing:</strong> React Router v7</li>
            <li><strong>State/Data:</strong> Axios (HTTP), Local Component State</li>
            <li><strong>Analysis:</strong> ESlint</li>
        </ul>

        <h3>2.3 Mobile Client (App)</h3>
        <ul>
            <li><strong>Framework:</strong> Flutter (Dart 3.x)</li>
            <li><strong>Architecture:</strong> Provider Pattern (State Management)</li>
            <li><strong>Networking:</strong> Dio</li>
            <li><strong>Visuals:</strong> fl_chart (for graphs), Google Fonts</li>
            <li><strong>Platform:</strong> Android / iOS (configured)</li>
        </ul>

        <h2>3. Detailed Data Model (Database Schema)</h2>
        <p>The application defines the following core entities in <code>com.hospital.dashboard.model</code>:</p>
        <table>
            <thead>
                <tr>
                    <th>Entity</th>
                    <th>Primary Key</th>
                    <th>Key Fields</th>
                    <th>Relationships</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Patient</strong></td>
                    <td><code>id</code> (Long)</td>
                    <td><code>firstName</code>, <code>lastName</code>, <code>ssn</code>, <code>birthDate</code></td>
                    <td>OneToMany with Stays, MedicalActs, Consumables</td>
                </tr>
                <tr>
                    <td><strong>HospitalStay</strong></td>
                    <td><code>id</code> (Long)</td>
                    <td><code>startDate</code>, <code>endDate</code>, <code>dailyRate</code>, <code>pathology</code>
                    </td>
                    <td>ManyToOne to Patient</td>
                </tr>
                <tr>
                    <td><strong>MedicalAct</strong></td>
                    <td><code>id</code> (Long)</td>
                    <td><code>type</code> (name), <code>cost</code>, <code>date</code>, <code>practitionerId</code></td>
                    <td>ManyToOne to Patient</td>
                </tr>
                <tr>
                    <td><strong>Personnel</strong></td>
                    <td><code>id</code> (Long)</td>
                    <td><code>firstName</code>, <code>lastName</code>, <code>role</code>, <code>salary</code>,
                        <code>service</code></td>
                    <td>None (Standalone reference)</td>
                </tr>
                <tr>
                    <td><strong>Consumable</strong></td>
                    <td><code>id</code> (Long)</td>
                    <td><code>name</code>, <code>unitPrice</code>, <code>quantity</code>, <code>date</code></td>
                    <td>ManyToOne to Patient</td>
                </tr>
                <tr>
                    <td><strong>Medication</strong></td>
                    <td><code>id</code> (Long)</td>
                    <td><code>name</code>, <code>price</code>, <code>stockQuantity</code></td>
                    <td>None (Inventory tracking)</td>
                </tr>
            </tbody>
        </table>

        <h2>4. API Specification & Endpoints</h2>
        <p>The backend exposes a REST API via <code>com.hospital.dashboard.controller</code>. All endpoints are prefixed
            with <code>/api</code>.</p>

        <h3>4.1 Authentication</h3>
        <ul>
            <li><code>POST /api/auth/login</code>: Accepts <code>{email, password}</code>.
                <div class="note">Implementation: Hardcoded mock check (password="password"). Returns a dummy UUID
                    token.</div>
            </li>
        </ul>

        <h3>4.2 Core Business Logic</h3>
        <ul>
            <li><strong>Dashboard</strong>: <code>GET /api/dashboard/summary</code> (Aggregated KPIs: total patients,
                revenue, occupancy).</li>
            <li><strong>Patients</strong>: Full CRUD (<code>GET</code>, <code>POST</code>, <code>PUT</code>,
                <code>DELETE</code> to <code>/api/patients</code>).</li>
            <li><strong>Personnel</strong>: Full CRUD (<code>/api/personnel</code>).</li>
            <li><strong>Medical Acts</strong>: <code>/api/medical-acts</code></li>
            <li><strong>Stays</strong>: <code>/api/stays</code></li>
            <li><strong>Consumables</strong>: <code>/api/consumables</code></li>
            <li><strong>Forecasts</strong>: <code>GET /api/forecasts?days={N}</code> (Returns prediction data objects).
            </li>
        </ul>

        <h3>4.3 AI & Intelligence (Special Feature)</h3>
        <ul>
            <li><code>POST /api/custom-ai/ask</code>: RAG Endpoint.
                <ul>
                    <li><strong>Payload</strong>: <code>{"question": "..."}</code></li>
                    <li><strong>Logic</strong>:
                        <ol>
                            <li>Checks if Model is "trained" (Mock flag).</li>
                            <li>Calls <code>ForecastServiceV2</code> to get financial stats (Last 30 days cost,
                                Predicted 7 days cost, trend slope).</li>
                            <li>Injects stats into System Prompt ("You are an expert... here is real data: ...").</li>
                            <li>Sends to Local LLM via <code>OpenAiService</code>.</li>
                            <li>Returns <code>{ "answer": "..." }</code>.</li>
                        </ol>
                    </li>
                </ul>
            </li>
        </ul>

        <h2>5. Algorithmic Logic: Financial Forecasting</h2>
        <p><strong>Implemented Class:</strong> <code>com.hospital.dashboard.service.ForecastServiceV2</code><br>
            This service predicts future hospital costs based on historical data.</p>
        <p><strong>Algorithm Steps:</strong></p>
        <ol>
            <li><strong>Data Extraction</strong>: Fetches all <code>MedicalAct</code>, <code>Consumable</code>, and
                <code>HospitalStay</code> records.</li>
            <li><strong>Aggregation</strong>: Groups costs by date (Daily mode) or month (Monthly mode).</li>
            <li><strong>Seasonality Calculation</strong>:
                <ul>
                    <li>Calculates a "Seasonality Index" for each Day of Week (Mon-Sun).</li>
                    <li><em>Formula:</em> <code>Index = (Average Cost for Day X) / (Global Average Daily Cost)</code>
                    </li>
                </ul>
            </li>
            <li><strong>Trend Analysis (Linear Regression)</strong>:
                <ul>
                    <li>Uses <code>Apache Commons Math3</code> (<code>SimpleRegression</code>).</li>
                    <li>Fits a line (<code>y = ax + b</code>) to the historical cost data.</li>
                </ul>
            </li>
            <li><strong>Prediction Generation</strong>:
                <ul>
                    <li>Base Prediction = <code>Regression(FutureDate)</code></li>
                    <li>Final Prediction = <code>Base Prediction * SeasonalityIndex(FutureDate.DayOfWeek)</code></li>
                </ul>
            </li>
            <li><strong>Personnel Load</strong>: Adds fixed daily personnel costs (base load) to both historical and
                predicted values.</li>
        </ol>

        <h2>6. Client-Side Implementation Details</h2>

        <h3>6.1 Web Routing (React)</h3>
        <p>Defined in <code>App.jsx</code>, mapping URL paths to <code>pages/</code> components:</p>
        <ul>
            <li><code>/</code> -> <code>Dashboard.jsx</code> (KPI Cards)</li>
            <li><code>/patients</code> -> <code>Patients.jsx</code> (DataGrid)</li>
            <li><code>/forecasts</code> -> <code>Forecasts.jsx</code> (Recharts LineChart with "Real" vs "Predicted"
                series)</li>
            <li><code>/chat</code> -> <code>ChatAssistant.jsx</code> (Chat interface)</li>
            <li>...and other CRUD pages.</li>
        </ul>

        <h3>6.2 Mobile Structure (Flutter)</h3>
        <p>Located in <code>mobile/lib/presentation/screens</code>:</p>
        <ul>
            <li><code>access</code>: <code>LoginScreen</code>, <code>SplashScreen</code></li>
            <li><code>core</code>: <code>MainContainer</code> (holds the Bottom Navigation Bar), <code>MenuScreen</code>
            </li>
            <li><code>features</code>:
                <ul>
                    <li><code>DashboardScreen</code>: Grid of KPI widgets.</li>
                    <li><code>PrevisionsScreen</code>: Mobile version of forecasts using <code>fl_chart</code>.</li>
                    <li><code>ChatScreen</code>: Mobile chat bubble interface.</li>
                    <li><code>PatientsScreen</code>: ListView of patients with detail drill-down.</li>
                </ul>
            </li>
        </ul>

        <h2>7. Quality Assurance (Q.A.)</h2>
        <ul>
            <li><strong>Selenium Tests</strong> (<code>selenium-tests</code> folder):
                <ul>
                    <li>Suite: <code>HospitalDashboardTests.java</code></li>
                    <li>Coverage: 10 Scenarios (Dashboard load, Patient Add/Edit/Delete, Chatbot timeout check, Page
                        Navigation).</li>
                </ul>
            </li>
            <li><strong>Performance</strong>:
                <ul>
                    <li>File: <code>performance_test.jmx</code> (Apache JMeter test plan).</li>
                    <li>Target: Load testing the <code>/api/dashboard</code> and <code>/api/patients</code> endpoints.
                    </li>
                </ul>
            </li>
        </ul>

        <h2>8. Inactive / Legacy Components</h2>
        <ul>
            <li><strong>MySQL Support</strong>: Dependencies exist, but deactivated in favor of H2.</li>
            <li><strong>ForecastService (V1)</strong>: Code likely removed or refactored into V2; V2 is the active
                Spring Bean.</li>
            <li><strong>Remote OpenAI</strong>: <code>openai.api.key</code> is a placeholder. System relies entirely on
                local inference.</li>
        </ul>
    </div>
</body>

</html>